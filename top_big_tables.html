<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.0/build/styles/default.min.css">



    <title>Hello from Chagall!</title>
  </head>
  <body>
    <div class="container">

        
    
    <div class="row">
        <img src='https://quickchart.io/chart?c=%7B%0A%20%20%20%20%22type%22%3A%20%22outlabeledPie%22%2C%0A%20%20%20%20%22data%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%22labels%22%3A%20%5B%22others%22%2C%20%22flights%22%2C%20%22tickets%22%2C%20%22bookings%22%2C%20%22ticket_flights%22%2C%20%22boarding_passes%22%5D%2C%0A%20%20%20%20%20%20%20%20%22datasets%22%3A%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22backgroundColor%22%3A%20%5B%22%23903439%22%2C%20%22%23587ba8%22%2C%20%22%232a568e%22%2C%20%22%23834fac%22%2C%20%22%23490b84%22%2C%20%22%238277d6%22%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22data%22%3A%20%5B245760%2C%205054464%2C%2061964288%2C%2019660800%2C%20113909760%2C%2084590592%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20%7D%2C%0A%20%20%20%20%22options%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%22title%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22display%22%3A%20true%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22text%22%3A%20%22Top%205%20largest%20tables%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%22plugins%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22legend%22%3A%20false%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22outlabels%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22text%22%3A%20%22%25l%20%25p%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22color%22%3A%20%22white%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22stretch%22%3A%2035%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22font%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22resizable%22%3A%20true%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22minSize%22%3A%2012%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22maxSize%22%3A%2018%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D'>
    </div>

    <div class="row">
        <pre>
            <code class="language-sql">
                

select json_agg(table_name)::text as labels
     , json_agg(total_size)::text as data
     , json_agg(concat('#',lpad(to_hex(round(random() * 10000000)::int4),6,'0')))::text as colors
  from (select table_name
             , sum(raw_total_size) as total_size
          from (select case
                         when rank() over (order by raw_total_size desc) <= %s then table_name
                         else 'others'
                       end as table_name
                     , raw_total_size
                  from (select table_name
                             , pg_total_relation_size(quote_ident(table_name)) as raw_total_size
                          from information_schema.tables
                         where table_schema = %s) s) s
         group by table_name) s
            </code>
        </pre>
    </div>



    
    
    

    

    <div class="row">
        <img src='https://quickchart.io/chart?c=%7B%0A%20%20%22type%22%3A%20%22doughnut%22%2C%0A%20%20%22data%22%3A%20%7B%0A%20%20%20%20%22datasets%22%3A%20%5B%0A%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%22data%22%3A%20%5B1046%2C%20580%2C%20367%2C%20263%2C%2034%5D%2C%0A%20%20%20%20%20%20%20%20%22backgroundColor%22%3A%20%5B%22%2372a12f%22%2C%20%22%23875a1c%22%2C%20%22%23655eb6%22%2C%20%22%234d06e2%22%2C%20%22%231d4366%22%5D%2C%0A%20%20%20%20%20%20%20%20%22label%22%3A%20%22Dataset%201%22%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%5D%2C%0A%20%20%20%20%22labels%22%3A%20%5B%22ticket_flights%22%2C%20%22boarding_passes%22%2C%20%22tickets%22%2C%20%22bookings%22%2C%20%22flights%22%5D%0A%20%20%7D%2C%0A%20%20%22options%22%3A%20%7B%0A%20%20%20%20%22title%22%3A%20%7B%0A%20%20%20%20%20%20%22display%22%3A%20true%2C%0A%20%20%20%20%20%20%22text%22%3A%20%22Top%205%20max%20rows%20tables%22%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D'>
    </div>

    <div class="row">
        <pre>
            <code class="language-sql">
                

select json_agg(table_name)::text as labels
     , json_agg(ceil(rows_count/1000))::text as data
     , json_agg(concat('#',lpad(to_hex(round(random() * 10000000)::int4),6,'0')))::text as colors
     
  from (select table_name
             , sum(rows_count) as rows_count
             , rank as id
          from (select relname as table_name
                     , rank() over (order by n_live_tup desc) as rank
                     , n_live_tup as rows_count
                  from pg_stat_all_tables
                 where schemaname = 'bookings') s
         where rank <= 5
         group by table_name, rank
         order by 2 desc) s
            </code>
        </pre>
    </div>



    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.0/build/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.0/build/languages/sql.min.js"></script>
    <script>hljs.highlightAll();</script>

  </body>
</html>